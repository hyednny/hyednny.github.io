{"componentChunkName":"component---src-templates-post-template-tsx","path":"/\bsequelize/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>Sequelize 란?</h3>\n<p>node.js에서 mysql 등 RDMS를 쉽게 다룰 수 있게 도와주는 라이브러리입니다.\nORM이라고 하는데 Object Relational Mapping 객체와 관계적인 매핑, 프로그래밍 언어의 객체와 데이터베이스의 데이터를 자동으로 연결해줍니다.</p>\n<h2>Sequelize 환경 변수 파일 설정</h2>\n<ol>\n<li>\n<p>Sequelize CLI 설치 </br>\n<code class=\"language-text\">yarn add sequelize-cli --dev</code></p>\n</li>\n<li>\n<p>빈 프로젝트 만들기</br>\n<code class=\"language-text\">yarn sequelize-cli init</code> </br>\n4가지 폴더가 생성됩니다. </br></p>\n</li>\n</ol>\n<ul>\n<li>config : CLI에 데이터베이스 연결 방법을 알려주는 구성 파일이 포함되어 있습니다. (config.json)</li>\n<li>models : 프로젝트의 모든 모델이 포함되어 있습니다.</li>\n<li>migrations : 모든 마이그레이션 파일을 포함합니다.</li>\n<li>seeders : 모든 시드 파일을 포함합니다.</li>\n</ul>\n<ol start=\"3\">\n<li>config.json 수정하기 </br>\n데이터베이스를 사용하는데 필요한 정보를 저장해두는 곳입니다.</br>\n그러나 json파일은 모듈을 불러오고 사용하는 것이 불가능하기 때문에</br>\ndotenv 모듈을 불러와서 사용하려면 해당 파일을 config.js나 config.ts로 바꾸고 수정해야합니다.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'dotenv'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">config</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">development</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">username</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_USER</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">password</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_PASSWORD</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">database</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DATABASE</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">host</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_HOST</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">port</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_PORT</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">dialect</span><span class=\"token operator\">:</span> <span class=\"token string\">'mysql'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">timezone</span><span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">DB_TIMEZONE</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">production</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"4\">\n<li>models 안에 index.js 수정하기</br></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Sequelize <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'sequelize'</span>\n<span class=\"token keyword\">import</span> config <span class=\"token keyword\">from</span> <span class=\"token string\">'config'</span>\n\n<span class=\"token keyword\">const</span> database <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'DATABASE'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> username <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'DB_USERNAME'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> password <span class=\"token operator\">=</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'DB_PASSWORD'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> sequelize <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Sequelize</span><span class=\"token punctuation\">(</span>database<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  host<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'DB_HOST'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  dialect<span class=\"token operator\">:</span> <span class=\"token string\">'mysql'</span><span class=\"token punctuation\">,</span>\n  timezone<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'DB_TIMEZONE'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  dialectOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> ssl<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  pool<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    max<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n    min<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    idle<span class=\"token operator\">:</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>수정했더니 아래와 같은 에러가 났습니다. </br>\n“unknown error: Code: UNAVAILABLE\\nserver does not allow insecure connections, client must use SSL/TLS\\n” </br>\n클라이언트가 SSL/TLS를 사용해야 한다는 뜻..</p>\n<ul>\n<li>SSL/TLS : 클라이언트와 서버 프로그램이 네트워크로 통신하는 과정에서 서로 간의 신뢰할 수 있는 전자 서명이 포함된 인증서를 사용하여 암호화 통신 프로토콜 </br></br>\n암호화하여 송수힌 하는 프로토콜인 SSL/TLS는 클라이언트와 서버 간에도 사용할 SSL/TLS 버전을 지정하는 과정을 수행하고 서버와 클라이언트 간의 버전 호환성이 맞아야 통신이 가능합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token punctuation\">{</span>\n<span class=\"token operator\">...</span>\n  timezone<span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span><span class=\"token generic-function\"><span class=\"token function\">get</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">'DB_TIMEZONE'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  dialectOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> ssl<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>rejectUnauthorized<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//추가</span>\n  pool<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    max<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n    min<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    idle<span class=\"token operator\">:</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><a href=\"https://sequelize.org/docs/v6/other-topics/dialect-specific-things/\" target=\"_blank\" rel=\"nofollow\">https://sequelize.org/docs/v6/other-topics/dialect-specific-things/</a>\ndialectOptions : Sequelize 생성자를 사용하여 사용자 정의 옵션을 제공할 수 있습니다.</br>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 41.14583333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA10lEQVR42qWRyQ7CMAxEc+ty6CKSplnahNLl/79w0FgqCDiAxOHJTmqPJ66apgn7vmPbNjBPKcEYI1hr4ZyD9/4D1rPvOA7M1xvCdYUPAYof1/WGZVmQcxbBEII0DcOAcRwfcADvGFlHckpwIcLFBOc9BQOmvOCijQhprSXSWdu2L9A1BRlZd77EGA3L4dZCcQpFy7JEURSoqkoiz8xP6roW1zHGR5znWdZ03tG54qSmadD3/VfeHbOPnDm1FJ/wi9gv8PkiyAld1/0FNcQh/95zuf/BHd4BjhrG3fs0FrkAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/53749bb5d36595f63040cc42ae8e78c8/a59e9/mysql_planetscale.webp 192w,\n/static/53749bb5d36595f63040cc42ae8e78c8/0ca9f/mysql_planetscale.webp 384w,\n/static/53749bb5d36595f63040cc42ae8e78c8/dc9b9/mysql_planetscale.webp 768w,\n/static/53749bb5d36595f63040cc42ae8e78c8/e2c2f/mysql_planetscale.webp 1152w,\n/static/53749bb5d36595f63040cc42ae8e78c8/f3efb/mysql_planetscale.webp 1536w,\n/static/53749bb5d36595f63040cc42ae8e78c8/fe585/mysql_planetscale.webp 1670w\" sizes=\"(max-width: 768px) 100vw, 768px\" type=\"image/webp\">\n          <source srcset=\"/static/53749bb5d36595f63040cc42ae8e78c8/3b721/mysql_planetscale.png 192w,\n/static/53749bb5d36595f63040cc42ae8e78c8/66595/mysql_planetscale.png 384w,\n/static/53749bb5d36595f63040cc42ae8e78c8/fe486/mysql_planetscale.png 768w,\n/static/53749bb5d36595f63040cc42ae8e78c8/d2d74/mysql_planetscale.png 1152w,\n/static/53749bb5d36595f63040cc42ae8e78c8/e8464/mysql_planetscale.png 1536w,\n/static/53749bb5d36595f63040cc42ae8e78c8/941a4/mysql_planetscale.png 1670w\" sizes=\"(max-width: 768px) 100vw, 768px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/53749bb5d36595f63040cc42ae8e78c8/fe486/mysql_planetscale.png\" alt=\"mysql planetscale\" title=\"mysql planetscale\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n    </span></img></br>\nplanetscale에서 디비 생성해줘서 디비 URL 참고하여 rejectUnauthorized: true 를 추가했습니다. </br>\n정확히 맞는지는 잘 모르겠으나 추가했더니 에러를 해결할 수 있었습니다. </br></p>\n<p><code class=\"language-text\">DATABASE_URL=mysql://&lt;USER>:&lt;PASSWORD>@&lt;HOST>/&lt;DB-NAME>?ssl={}</code></p>\n<hr>\n<p><strong>참고 주소</strong></p>\n<ul>\n<li><a href=\"https://sequelize.org/docs/v7/cli/\" target=\"_blank\" rel=\"nofollow\">https://sequelize.org/docs/v7/cli/</a></li>\n<li><a href=\"https://github.com/planetscale/discussion/discussions/127\" target=\"_blank\" rel=\"nofollow\">https://github.com/planetscale/discussion/discussions/127</a></li>\n<li><a href=\"https://medium.com/finda-tech/mysql%EA%B3%BC-ssl-tls%ED%86%B5%ED%95%9C-%EC%A0%91%EC%86%8D-15262c49783e\" target=\"_blank\" rel=\"nofollow\">https://medium.com/finda-tech/mysql%EA%B3%BC-ssl-tls%ED%86%B5%ED%95%9C-%EC%A0%91%EC%86%8D-15262c49783e</a></li>\n</ul>","frontmatter":{"title":"Sequelize로 DB 세팅","summary":"Node.js Sequelize","date":"2024.01.10.","categories":["Javascript","Sequelize"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9ElEQVR42pWT0WtScRTH738SLIL9BTFYT1EGrUGwB7GnGtRjPQWLBsFYBUVQPfgQKL0EUbHYmjp1s7nUpRu63GRoszaZDVnJlnm99/7u9RP3V5oGgR34cg6/w++c8z3f308xhEAXAjDBMtEMgRAC0zSlb8W9QqFpymLJisb2oS5jUwiMjqL/8p0NW14p1QRjqzUGgzVOR+p48nUMqwk00XWj62IvUAYDBzjeqpx6/YWzL4ucWBSM+MqU9w+wTYhfVCzLhtWexI7tps2mJWM7Lycc9uYYcKfpu5fg6KM1hh8u4Lh0lyl/gvxWie+1OoZh0NA06mqjvasfdZXPO3t8qx7SaGgShiFQnN51+m/46b8V5tiom5NXn+C6fJvpQILllRzz0TRTvhhzkVXmIim2Pu0yE1zm1UwUXzjFYvwDgfkUL6ajFIplFKcny8BEiCPX39B30c35sacMucYJRdNs5rfxh5PEUzki7zKycOz9OrOhJPHkBmsbRdkwmsiysJRhr1JFOX4nxhXPCufuR3Bee8zI6CQO5002CyVJwaanabqkuLNbaQulqprcnZ1TbcqaJnNK4uNXXN4sZyaDDF0YZ+LBMyr7VSmIZXYL0n3WKZD5RxRbKRvPl/IkMwVaZhjiv5+MfDb674sts8duUf37p/Tya34CaKsZWy789xwAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/82af4e273e91fcc34794e2a3e0120367/70d54/sequelize.png","srcSet":"/static/82af4e273e91fcc34794e2a3e0120367/342d4/sequelize.png 238w,\n/static/82af4e273e91fcc34794e2a3e0120367/80f40/sequelize.png 476w,\n/static/82af4e273e91fcc34794e2a3e0120367/70d54/sequelize.png 952w","sizes":"(min-width: 952px) 952px, 100vw"},"sources":[{"srcSet":"/static/82af4e273e91fcc34794e2a3e0120367/d8860/sequelize.webp 238w,\n/static/82af4e273e91fcc34794e2a3e0120367/62943/sequelize.webp 476w,\n/static/82af4e273e91fcc34794e2a3e0120367/df3c0/sequelize.webp 952w","type":"image/webp","sizes":"(min-width: 952px) 952px, 100vw"}]},"width":952,"height":506}},"publicURL":"/static/82af4e273e91fcc34794e2a3e0120367/sequelize.png"}}}}]}},"pageContext":{"slug":"/\bsequelize/"}},"staticQueryHashes":[],"slicesMap":{}}
{"componentChunkName":"component---src-templates-post-template-tsx","path":"/cors/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>CORS 란?</h3>\n<p>Cors(Cross-Origin Resource Sharing) 는 간단하게 말해서 <strong>교차 출처 리소스 공유</strong>입니다. </br>\n출처가 다른 자원들을 공유한다는 뜻으로, 한 출처가 있는 자원에서 다른 출처에 있는 자원에 접근하도록 하는 개념입니다. </br>\n웹 애플리케이션은 리소스가 자신의 출처(도메인, 프로토콜, 포트)와 다를 때 교차 출처 HTTP 요청을 실행합니다. (mdn 설명)</p>\n<h3>같은 출처란 ?</h3>\n<p>아래의 사진은 URL이 어떤 구성요소로 이루어져 있는지 나와있습니다.\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1ae7058789dc46ed47d4efeda7edf73a/b4ad3/cors_url.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.35416666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiUlEQVR42pWSS0sbYRSG5/f1B7ioP0CEdttNBLuotEtLEQyEwU1Ii2JLm3ZVKCpCMUVRa9NERxuTzGRmmsyYucd831MySURjCu2Bl3Ph8HIuryKlRApB6qVEjHA7HueM/HQMORT+w+Q/9Cg9Syf8/o1+Q6OpWxy0Ig6NgNN2zL4ecGwG/LBjPMeAThnbNDB0k6tLD/fCI7BitMufVPRD7KsWigx9uucVelYTP4iod3vU3Ygzq8u5k9DyEgz/GsduIL0mrutgmhaxk9CuOURujN1pcWFU6Xj2cOVk6vDXdxaNATHRESXR/ZXDr58xXmb4nXuBtHV6wJNildn8EWUrHFK7v+h8mCfaW+bt5ibqmkrtpM6nxS/s5kq8eveUBXWON1tZlHD7I7Vnj2ksZ5BWIyWcWz/hQXYvvd/AhKNhrz/E31nidaHAyuoKpyWN7EyejUyR1ffPWVQfsbGtTvmylBOp/OvLfTMkcu8eTEn1NtDhWIuDicSoNia70apI6wPcFpEQffqin9b/AAaio1YF9wkUAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/1ae7058789dc46ed47d4efeda7edf73a/a59e9/cors_url.webp 192w,\n/static/1ae7058789dc46ed47d4efeda7edf73a/0ca9f/cors_url.webp 384w,\n/static/1ae7058789dc46ed47d4efeda7edf73a/dc9b9/cors_url.webp 768w,\n/static/1ae7058789dc46ed47d4efeda7edf73a/5c666/cors_url.webp 1080w\" sizes=\"(max-width: 768px) 100vw, 768px\" type=\"image/webp\">\n          <source srcset=\"/static/1ae7058789dc46ed47d4efeda7edf73a/3b721/cors_url.png 192w,\n/static/1ae7058789dc46ed47d4efeda7edf73a/66595/cors_url.png 384w,\n/static/1ae7058789dc46ed47d4efeda7edf73a/fe486/cors_url.png 768w,\n/static/1ae7058789dc46ed47d4efeda7edf73a/b4ad3/cors_url.png 1080w\" sizes=\"(max-width: 768px) 100vw, 768px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/1ae7058789dc46ed47d4efeda7edf73a/fe486/cors_url.png\" alt=\"cors url\" title=\"cors url\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span></img></br></p>\n<p>Protocol, Host, Port, Path, Query String, Fragment로 이루어져 있습니다. </br>\n기본적으로 Protocol, Host, Port가 있어야 합니다. 그치만 HTTPS는 기본 포트가 정해져있어서 Port는 생략 가능합니다. </br>\n위의 구성요소 중에서 Protocol, Host, Port 3가지가 같으면 동일 출처라고 합니다.</p>\n<h3>동일 출처 정책(Same-Origin Policy)</h3>\n<ul>\n<li>동일 출처 정책 : 동일 출처 요청만 자유롭게 요청이 가능합니다. 다른 출처로부터 조회된 자원들의 읽기 접근을 막아 다른 출처 공격을 예방합니다. </br></br>\n그러나 다른 출처에서 얻은 이미지를 담은 &#x3C; img>, 외부 주소를 담는 &#x3C; link> 같은 여러 태그들을 허용합니다. </br>\n다른 출처 리소스에 접근성을 높이기 위해서 다른 출처 정책(Cross-Origin Policy) <strong>CORS</strong>가 등장했습니다.</li>\n</ul>\n<h3>CORS 3가지 동작 방식</h3>\n<ol>\n<li><strong>단순 요청(Simple Request)</strong></li>\n</ol>\n<ul>\n<li>\n<p>메서드 : <strong>GET, HEAD, POST</strong> 중 하나만 가능합니다.</p>\n</li>\n<li>\n<p>헤더 : <strong>Accept, Accept-Language, Content-Language, Content-Type</strong> 만 가능합니다.</p>\n</li>\n<li>\n<p>Content-Type 헤더 : <strong>application/x-www-form-urlencoded, multipart/form-data, text/plain</strong> 만 가능합니다.</p>\n</li>\n<li>\n<p><strong>ReadableStream</strong> 객체 사용되지 않습니다.</p>\n</li>\n<li>\n<p><strong>XMLHttpRequest.upload</strong> 통해서만 이벤트 리스너를 등록 가능합니다.</p>\n</br>\n브라우저는 다른 출처에 자신의 주소를 origin에 담아 요청을 보내고 서버는 요청을 확인한 뒤 다른 출처 주소에 접근이 가능하다는 access-control-allow-origin 에 해당 주소를 담아서 결과를 리턴합니다. </br></br>\naccess-control-allow-origin 은 CORS 헤더의 중요 요소 중 하나로 어떤 요청을 허용할지 결정합니다. </br>\n이 헤더 값은 특정 도메인에 대해 접근을 제한하고 싶다면 하나의 출처가 될 수도 있고, \"*\" 사용해서 어떤 출처도 허용하도록 할 수 있습니다. </br>\n</li>\n</ul>\n<p>위에 나온 조건들을 지켜야 요청이 가능합니다. 인증을 위한 Authorization 헤더, Content-Type 헤더 값이 application/json 로 설정되어 있는 경우에서 Simple Request를 사용하기 어렵습니다. </br></br></p>\n<ol start=\"2\">\n<li><strong>프리 플라이트(Preflight Request)</strong></li>\n</ol>\n<p>OPTIONS 메서드로 HTTP 요청을 미리 보내 실제 요청이 전송하기에 안전한지 확인합니다.</p>\n<ul>\n<li><a href=\"https://domain-a.com\" target=\"_blank\" rel=\"nofollow\">https://domain-a.com</a> 에서 <a href=\"https://domain-b.com\" target=\"_blank\" rel=\"nofollow\">https://domain-b.com</a> 가 안전한지 확인하려면 <a href=\"https://domain-b.com\" target=\"_blank\" rel=\"nofollow\">https://domain-b.com</a> 서버로 Preflight Request를 보냅니다. </br></li>\n</ul>\n<p>Origin은 <a href=\"http://domain-a.com\" target=\"_blank\" rel=\"nofollow\">http://domain-a.com</a> 이 되고 Access-Control-Request-Method 는 실제 요청 보낼 때 사용할 메서드를 적어줍니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//Preflight Request</span>\n<span class=\"token constant\">OPTIONS</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>domain<span class=\"token operator\">-</span>b<span class=\"token punctuation\">.</span>com<span class=\"token operator\">?</span>q<span class=\"token operator\">=</span>test\n\nAccess<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span>Request<span class=\"token operator\">-</span>Method<span class=\"token operator\">:</span> <span class=\"token constant\">GET</span>\nOrigin<span class=\"token operator\">:</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>domain<span class=\"token operator\">-</span>a<span class=\"token punctuation\">.</span>com</code></pre></div>\n<ul>\n<li>서버는 Preflight Response를 보냅니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//Preflight Response</span>\nAccess<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span>Allow<span class=\"token operator\">-</span>Origin<span class=\"token operator\">:</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>domain<span class=\"token operator\">-</span>a<span class=\"token punctuation\">.</span>com\nAccess<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span>Request<span class=\"token operator\">-</span>Method<span class=\"token operator\">:</span> <span class=\"token constant\">GET</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">//정상 요청과 응답이 가능하면 브라우저가 서버에게 요청을 보냅니다</span>\n<span class=\"token comment\">//Request</span>\n<span class=\"token constant\">GET</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>domain<span class=\"token operator\">-</span>b<span class=\"token punctuation\">.</span>com<span class=\"token operator\">?</span>q<span class=\"token operator\">=</span>test\n\nOrigin<span class=\"token operator\">:</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>domain<span class=\"token operator\">-</span>a<span class=\"token punctuation\">.</span>com\n\n<span class=\"token comment\">//서버가 응답을 보냅니다.</span>\n<span class=\"token comment\">//Response</span>\nAccess<span class=\"token operator\">-</span>Control<span class=\"token operator\">-</span>Allow<span class=\"token operator\">-</span>Origin<span class=\"token operator\">:</span> https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>domain<span class=\"token operator\">-</span>a<span class=\"token punctuation\">.</span>com</code></pre></div>\n<p>실제 요청이 실행되기 전 검사를 허용할지 안할지 결정할 수 있기 때문에 Preflight Request를 사용하는게 좋습니다.</p>\n<ol start=\"3\">\n<li><strong>신용 요청(Credentialed Request)</strong></li>\n</ol>\n<p>Credentaled Request를 통해서 쿠키, 인증 헤더 등 신용 정보와 함께 요청합니다.\n기본적으로 출처가 다른 경우에는 쿠키나 인증 관련 헤더(Authorization)를 보낼 수 없습니다. </br>\n가능하도록 하려면 프론트와 서버 양쪽 모두 CORS를 설정해야 합니다.</p>\n<ul>\n<li>프론트 설정</li>\n</ul>\n<ol>\n<li>\n<p>fetch API\nfetch API는 credentals 옵션을 사용하는데 세가지 값 중 하나를 가질 수 있습니다.</p>\n<ul>\n<li>same-origin(기본값) : 같은 Origin 사이에만 인증 정보를 담습니다.</li>\n<li>include : 모든 요청에 인증 정보를 담습니다.</li>\n<li>omit : 모든 요청에 인증 정보를 담지 않습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://domain-a.com'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  credentials<span class=\"token operator\">:</span> <span class=\"token string\">'include'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>axios\naxios에서는 withCredentials 옵션을 사용합니다.</p>\n<ul>\n<li>falste(기본값)</li>\n<li>true : Credentialed Request를 위해서는 true로 설정해야 합니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">axios<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://domain-a.com'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  withCredentials<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ol>\n<ul>\n<li>서버 설정</li>\n</ul>\n<ol>\n<li>Access-Control-Allow-Credentials: true</li>\n<li>Access-Control-Allow-Origin 설정합니다. 헤더는 와일드 카드 (*) 를 사용하면 안되고 특정 도메인을 지정해야 합니다.</li>\n<li>Access-Control-Allow-Methods 와 Access-Control-Allow-Headers의 값을 지정해야 할 경우 와일드 카드 (*)를 사용하지 않습니다.</li>\n</ol>\n<h3>express cors 설정</h3>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\">app<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n  <span class=\"token function\">Cors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    origin<span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost:3000'</span><span class=\"token punctuation\">,</span>\n    methods<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'POST'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'PUT'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'PATCH'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'DELETE'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//허용할 HTTP 메서드</span>\n    allowedHeaders<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'Authorization'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'Access-Control-Allow-Origin'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">'Access-Control-Allow-Credentials'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//허용할 HTTP 헤더</span>\n    credentials<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h3>allowedHeaders</h3>\n<p>CORS 설정에서 allowedHeaders에 Content-Type, Authorization 등 이 헤더들을 포함시키는 것은 브라우저가 요청을 보낼 때 이러한 헤더가 포함되어 있을 경우에만 서버에서 요청을 허용하도록 하는 것입니다. </br>\n따라서 서버는 이러한 헤더를 허용하는 정책을 설정하여 CORS 문제를 방지할 수 있습니다.</p>\n<ol>\n<li><strong>Content-Type</strong>\n<ul>\n<li>HTTP요청 또는 응답의 본문에 포함된 데이터 유형을 나타냅니다.</li>\n<li>POST나 PUT과 같은 요청에서 서버에게 전송되는 데이터의 형식을 명시하기 위해 사용합니다.</li>\n<li>JSON 데이터를 전송할 때는 ‘Content-Type: application/json’ 과 같이 설정됩니다.</li>\n</ul>\n</li>\n<li><strong>Authorization</strong>\n<ul>\n<li>클라이언트가 서버에게 인증 정보를 전달하는 데 사용합니다.</li>\n<li>주로 사용자의 인증 정보를 서버에게 전송할 때 사용자의 이름과 비밀번호의 조합 또는 토큰 등이 이 헤더에 포함될 수 있습니다.</li>\n</ul>\n</li>\n</ol>\n<hr>\n<p><strong>참고</strong></p>\n<ul>\n<li><a href=\"https://escapefromcoding.tistory.com/724\" target=\"_blank\" rel=\"nofollow\">https://escapefromcoding.tistory.com/724</a></li>\n<li><a href=\"https://surprisecomputer.tistory.com/32\" target=\"_blank\" rel=\"nofollow\">https://surprisecomputer.tistory.com/32</a></li>\n<li><a href=\"https://velog.io/@garcon/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-CORS%EC%99%80-credentials\" target=\"_blank\" rel=\"nofollow\">https://velog.io/@garcon/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-CORS%EC%99%80-credentials</a></li>\n</ul>","frontmatter":{"title":"CORS","summary":"CORS","date":"2024.01.17.","categories":["Express","Project"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACZklEQVR42p2U/U/aQBzG+4cv2ZbN6JaRLL4BLdlkvCzjpyETAWVMgWAkLtl+my8M0WFC7w5pDeWlvWe5q1RkKLpv8qSXu+unz3MvVWhzHuTPHAa9OkRx7uCu4nKcy7bTs2DmsmD+EFhABdNUMFWFImD0wgfHNq+BHLNqfE7nZxw0tggW0EC1IBT97AmuLnOeu1lAMT5KYZlVkNYz0Por0JhfOlU65CM4Hz7K3Wheh8RAGs9ByTzot7dgKxoUzu1bsIc5vAHqZ09BWwug331gQRXKJGyyPV1u5L71C7T5GuTiBcjxHFhIFQ6nwxzH8Z6TGp9rD9sYWCcw2p9Avr5xHd61g4/Z7UHvN0jz5XSHg8EAuVwOh4eHKBQK2N/fR7VaRalUQrlcxt7enpwzfm7tIQNtLrhAKbjxRNVqNezs7MhnpVJBPp+Hz+eDpmmIRqNIJpMwTffc2rbtGTFo4sYhxpJSSuVLwmE6nZba3t5GJpNBvV5HPB7H6enpRHyAOz0oAmTDlm52C7soFosyYjgcRiKRkLBIJCKjC6fZbBapVAqbm5uyT4yfn597UCVrbOEdW0OsFceRfoQ2YTBMA+12W37EsizZ1nVdqtPpoNvtgjEmJZwSQrz1VJbICgJExSJZxuerJP63RkunqDSEINUQJK7I0P2aw2+fuVkaQRUJu5Zw2ug3POC0Fyav6L3AZbKK496Jexy4DcfhD4KO93tAEX2JrCJjZGeu0zTQqJRRVCHpUvfji7kBcmXgx0Ef6+uX2NoyQPT7f3H/OPSgJIRltoJAI4pgpIGNlInIB4q19xSmac+8738BaSHUPrzhnp4AAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/79fb80cafb954e9e5e60080eec7d7377/d0859/cors.png","srcSet":"/static/79fb80cafb954e9e5e60080eec7d7377/f1689/cors.png 270w,\n/static/79fb80cafb954e9e5e60080eec7d7377/42fd3/cors.png 540w,\n/static/79fb80cafb954e9e5e60080eec7d7377/d0859/cors.png 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/79fb80cafb954e9e5e60080eec7d7377/7e223/cors.webp 270w,\n/static/79fb80cafb954e9e5e60080eec7d7377/5cfb6/cors.webp 540w,\n/static/79fb80cafb954e9e5e60080eec7d7377/941f9/cors.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":1080}},"publicURL":"/static/79fb80cafb954e9e5e60080eec7d7377/cors.png"}}}}]}},"pageContext":{"slug":"/cors/"}},"staticQueryHashes":[],"slicesMap":{}}
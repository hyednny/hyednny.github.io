{"componentChunkName":"component---src-templates-post-template-tsx","path":"/oauth2/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3>Oauth2 이란?</h3>\n<p>Oauth 2.0 은 <strong>Open Authorization 2.0</strong> 로 인증을 위한 개방향 표준 프로토콜입니다.</br>\n인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통적인 수단으로서 사용되는 접근 위임을 위한 개방형 표준입니다.</p>\n<h3>용어 정리</h3>\n<ul>\n<li><strong>Authentication (인증)</strong>\n</br> 접근 자격이 있는지 검증하는 단계</br></br></li>\n<li><strong>Authorization (인가)</strong>\n</br> 자원에 접근할 권한을 부여하고 리소스 접근 권한이 담긴 Access Token을 제공</br></br></li>\n<li><strong>Access Token</strong>\n</br> 리소스 서버에게서 정보를 획득할 때 사용되는 토큰으로 만료 기간이 존재</br></br></li>\n<li><strong>Refresh Token</strong>\n</br> Access Token 만료 시 재발급 받기 위한 용도로 사용하는 Token</li>\n</ul>\n<h3>트위터 Oauth2 사용</h3>\n<ol>\n<li>\n<p>Developer Portal에서 Project 생성</br>\n<a href=\"https://developer.twiiter.com/en/portal/dashboard\" target=\"_blank\" rel=\"nofollow\">https://developer.twiiter.com/en/portal/dashboard</a> </br></p>\n<p>a. Oauth 2.0 Client ID 와 Client Secret이 생성</br>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6a9789c59e9b68c8145afbdc27b86566/2561a/oauth2_twitter1.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 40.10416666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABSUlEQVR42n2SzU7DMBCE81xIXDhw4IKExIELEhfetlAgaelPmrRpU6QKNXYcJ7GdDNptmxYqYemznPXueLK2NxqN0X97RziLEAyG8IMBxpMpBsNP+H6A0XiCDz9Amq7Bo8W/w5N5jkwIKFVACMlrigkhkGUCUuYQUkJrjaZp4P7Qtg2f0rY7PGMtCq2Z2hhY50AxgtaVMVC6RFnX/N1hLZxzKMoSWa4gcsX1nioKxPM5kuUKWyFR1TXKquqQqsB6880Fvxw6x2xFjuXXhnOo1nMnp3bO9hxcNg3tWxhjjlh71j/S8rjY2aOoMWy9ozad8CmUN5mG6L320XvpI4wiuMbBy5XCLIqZeJEgk+e/vUpT3p+GMyaeL/hV3N0/4PrmFheXV3h8et71kKbDpRAkQDESrffoskRRaFC/D1DeIknYJT2zVbrm3v4Ad/pgJxaOAnsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/6a9789c59e9b68c8145afbdc27b86566/a59e9/oauth2_twitter1.webp 192w,\n/static/6a9789c59e9b68c8145afbdc27b86566/0ca9f/oauth2_twitter1.webp 384w,\n/static/6a9789c59e9b68c8145afbdc27b86566/dc9b9/oauth2_twitter1.webp 768w,\n/static/6a9789c59e9b68c8145afbdc27b86566/e2c2f/oauth2_twitter1.webp 1152w,\n/static/6a9789c59e9b68c8145afbdc27b86566/f490a/oauth2_twitter1.webp 1180w\" sizes=\"(max-width: 768px) 100vw, 768px\" type=\"image/webp\">\n          <source srcset=\"/static/6a9789c59e9b68c8145afbdc27b86566/3b721/oauth2_twitter1.png 192w,\n/static/6a9789c59e9b68c8145afbdc27b86566/66595/oauth2_twitter1.png 384w,\n/static/6a9789c59e9b68c8145afbdc27b86566/fe486/oauth2_twitter1.png 768w,\n/static/6a9789c59e9b68c8145afbdc27b86566/d2d74/oauth2_twitter1.png 1152w,\n/static/6a9789c59e9b68c8145afbdc27b86566/2561a/oauth2_twitter1.png 1180w\" sizes=\"(max-width: 768px) 100vw, 768px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/6a9789c59e9b68c8145afbdc27b86566/fe486/oauth2_twitter1.png\" alt=\"oauth2 twitter1\" title=\"oauth2 twitter1\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span></img></br>\nconfig 파일에 저장해둔다.</br></br>\nb. User authentication setting -> Redirect URL 수정\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/33c0f7513f863bcb472ad4e8760a7e2e/d1716/oauth2_twitterUrl.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 66.14583333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpklEQVR42p1S23KbMBDl/z+ombaT93acAE4bhxAnNnYMkiANyNwEiNPZNenQzqRNo5nDXiT2cnad+4cNVjcBllff4Lo+/OUVPM/HTXALz1/iy9cFtD6CzjiO+Ndxur6H6TpGN+FFb9sWZVWxPgwD+hmGGV5sSugYY5AICSElDnGMQ5IgVSn2SkA1msqC6Xt0EyhZawyjaVsG+UhSYIeUS8/H4sJleXHpwvWWWHgertchwrs1NtsI6/sHBGGIbbTDJoo4cVnVqJuG7/XxCGstHGqL+Pp+vUJwG2IVBPxACIndbs/6/vGAzXbL8liWqNuWAzWT/PGco6prbps5lEpBSDVJiULrX+11s3bnfDOMYbDfmFPA1yZH/vfAeS3Ye49DJH84+8jD+PT5HFKqWdAT/qvCuq4RRTukWcYgmy4Ga2HtyPjzp79WSEQqlfIwsqcnxHECIQQSmUI1QFqN6PvhTfxyQFpGmq5KU16VLDsFpSSK/Erh8RDzHdHxnOdMhJ11YMdxsi0c+uRFAa01P6aVIZ0WlfwE8ud5gaIoUJYVV/NbQHuyicOfvdPps8aBRnsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <picture>\n          <source srcset=\"/static/33c0f7513f863bcb472ad4e8760a7e2e/a59e9/oauth2_twitterUrl.webp 192w,\n/static/33c0f7513f863bcb472ad4e8760a7e2e/0ca9f/oauth2_twitterUrl.webp 384w,\n/static/33c0f7513f863bcb472ad4e8760a7e2e/dc9b9/oauth2_twitterUrl.webp 768w,\n/static/33c0f7513f863bcb472ad4e8760a7e2e/04a2c/oauth2_twitterUrl.webp 774w\" sizes=\"(max-width: 768px) 100vw, 768px\" type=\"image/webp\">\n          <source srcset=\"/static/33c0f7513f863bcb472ad4e8760a7e2e/3b721/oauth2_twitterUrl.png 192w,\n/static/33c0f7513f863bcb472ad4e8760a7e2e/66595/oauth2_twitterUrl.png 384w,\n/static/33c0f7513f863bcb472ad4e8760a7e2e/fe486/oauth2_twitterUrl.png 768w,\n/static/33c0f7513f863bcb472ad4e8760a7e2e/d1716/oauth2_twitterUrl.png 774w\" sizes=\"(max-width: 768px) 100vw, 768px\" type=\"image/png\">\n          <img class=\"gatsby-resp-image-image\" src=\"/static/33c0f7513f863bcb472ad4e8760a7e2e/fe486/oauth2_twitterUrl.png\" alt=\"oauth2 twitterUrl\" title=\"oauth2 twitterUrl\" loading=\"lazy\" decoding=\"async\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n        </picture>\n  </a>\n    </span></img></br></p>\n</li>\n<li>\n<p>Verify Link 생성</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> TwitterApi <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'twitter-api-v2'</span>\n<span class=\"token comment\">//twitter-api-v2 라이브러리 사용</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">TWITTER_CLIENT</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">TwitterApi</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">clientId</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>get <span class=\"token operator\">&lt;</span> string <span class=\"token operator\">></span> <span class=\"token string\">'TWITTER_CLIENT_ID'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">clientSecret</span><span class=\"token operator\">:</span> config<span class=\"token punctuation\">.</span>get <span class=\"token operator\">&lt;</span> string <span class=\"token operator\">></span> <span class=\"token string\">'TWITTER_CLIENT_SECRET'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>a. state, codeVerifier, url 을 가져옵니다</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> state<span class=\"token punctuation\">,</span> codeVerifier<span class=\"token punctuation\">,</span> url <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token constant\">TWITTER_CLIENT</span><span class=\"token punctuation\">.</span><span class=\"token function\">generateOAuth2AuthLink</span><span class=\"token punctuation\">(</span>\n  <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token constant\">API_ENDPOINT</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/v1/referral/callback/twitter</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">scope</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'users.read'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'tweet.read'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>b. redis에 codeVerifier 데이터를 저장합니다</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">capitalize</span><span class=\"token punctuation\">(</span>type<span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>state<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> <span class=\"token function\">minutesToSeconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>Callback</br>\na. redis에 저장되어있던 Twitter_${state} 를 가져와서 redis에 데이터가 있는지 체크해줍니다</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>get<span class=\"token operator\">&lt;</span>Record<span class=\"token operator\">&lt;</span>string<span class=\"token punctuation\">,</span> string<span class=\"token operator\">>></span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Twitter_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>state<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span>address <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span>codeVerifier<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BadRequestError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid twitter verification data'</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>b. loginWithOauth2 (code, codeVerifier, redirectUri)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>redis<span class=\"token punctuation\">.</span>get<span class=\"token operator\">&lt;</span>Record<span class=\"token operator\">&lt;</span>string<span class=\"token punctuation\">,</span> string<span class=\"token operator\">>></span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Twitter_</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>state<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>data <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span>address <span class=\"token operator\">||</span> <span class=\"token operator\">!</span>data<span class=\"token punctuation\">.</span>codeVerifier<span class=\"token punctuation\">)</span>\n <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BadRequestError</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Invalid twitter verification data'</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n</ol>","frontmatter":{"title":"Oauth2 개념과 트위터 Oauth2 사용","summary":"Oauth2 개념과 트위터 Oauth2 사용법","date":"2022.12.30.","categories":[],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArklEQVR42u1TsQrDIBDNjzs4J7NTcMmaRQhkzahzvkVQo75ioKEEayx0KCUHxym+e/fO0wZftuYm/HHCGOPu5/Xr/oy5JDxH7z1CCIfnMMWWc1VLmCLh8zApEUJgmiYopbCuK8ZxBOccy7JASrnjkvqqlrdtwzAMYIyBEAJKKbquQ9/3aNsW8zwfhNUtO+dgrd2TUkxFkmmtYYzJDu5yKLX3+NGzeedVCu+//KeED8LUKHgrAqslAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/45227bd4f5be87c0cfe83ed7c02fa3ee/d0859/oauth2.png","srcSet":"/static/45227bd4f5be87c0cfe83ed7c02fa3ee/f1689/oauth2.png 270w,\n/static/45227bd4f5be87c0cfe83ed7c02fa3ee/42fd3/oauth2.png 540w,\n/static/45227bd4f5be87c0cfe83ed7c02fa3ee/d0859/oauth2.png 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"},"sources":[{"srcSet":"/static/45227bd4f5be87c0cfe83ed7c02fa3ee/7e223/oauth2.webp 270w,\n/static/45227bd4f5be87c0cfe83ed7c02fa3ee/5cfb6/oauth2.webp 540w,\n/static/45227bd4f5be87c0cfe83ed7c02fa3ee/941f9/oauth2.webp 1080w","type":"image/webp","sizes":"(min-width: 1080px) 1080px, 100vw"}]},"width":1080,"height":1080}},"publicURL":"/static/45227bd4f5be87c0cfe83ed7c02fa3ee/oauth2.png"}}}}]}},"pageContext":{"slug":"/oauth2/"}},"staticQueryHashes":[],"slicesMap":{}}